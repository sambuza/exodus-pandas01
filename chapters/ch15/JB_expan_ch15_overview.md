# Chapter 15: 바다의 노래 — 피벗과 형태변환

## 개요 (Overview)
이번 챕터에서는 Pandas의 `pivot_table()`, `melt()`, `stack()`, `unstack()`과 같은 형태변환(Reshaping) 기술을 사용하여 데이터를 다양한 관점으로 재구성하고 숨겨진 패턴과 의미를 발견하는 방법을 배웁니다. 출애굽기 15장의 모세와 미리암의 노래, 그리고 요한복음 4장의 신령과 진정으로 드리는 예배를 통해, 하나님의 위대한 구원 역사를 다각도로 이해하고 예배의 본질을 탐구하는 과정을 살펴봅니다.

This chapter introduces Pandas' reshaping techniques like `pivot_table()`, `melt()`, `stack()`, and `unstack()` to reconfigure data from various perspectives and discover hidden patterns and meanings. Through the Song of Moses and Miriam in Exodus 15 and worship in spirit and truth in John 4, we will explore understanding God's great salvation history from multiple angles and delving into the essence of worship.

---

## 📜 성경 본문 깊이 묵상

### 출애굽기 15장: 모세와 미리암의 노래

이스라엘 백성이 홍해를 건넌 후, 모세와 미리암은 하나님을 찬양하는 승리의 노래를 불렀습니다. 이 노래는 하나님의 권능, 구원, 그리고 애굽에 대한 심판을 다양한 관점에서 선포하며, 이스라엘 백성의 경험을 재구성하여 하나님의 위대함을 드러냅니다.

- **모세의 노래:** 하나님의 권능과 구원을 찬양 (출 15:1-18)
- **미리암의 노래:** 소고를 잡고 춤추며 하나님을 찬양 (출 15:20-21)
- **노래의 내용:** 하나님의 위엄, 애굽 군대의 멸망, 이스라엘의 인도하심

이 노래는 단순한 일차원적인 서술이 아니라, 하나님의 속성, 인간의 반응, 사건의 결과 등 여러 차원의 정보를 담고 있습니다. `pivot_table()`은 이처럼 다양한 관점을 교차 분석하여 요약된 정보를 제공하며, `melt()`는 넓은 형식의 데이터를 긴 형식으로 변환하여 각 요소의 변화를 추적하는 데 유용합니다.

### 요한복음 4:23-24: 신령과 진정으로 예배할 때

예수님께서는 사마리아 여인에게 "아버지께 참으로 예배하는 자들은 신령과 진정으로 예배할 때가 오나니 곧 이때라 아버지께서는 자기에게 이렇게 예배하는 자들을 찾으시느니라 하나님은 영이시니 예배하는 자가 신령과 진정으로 예배할지니라"고 말씀하셨습니다. 이 말씀은 예배의 본질을 다양한 측면에서 재구성하여 이해할 것을 요구합니다.

- **예배의 본질:** 신령과 진정 (영과 진리)
- **예배의 대상:** 하나님 아버지
- **예배의 결과:** 하나님께서 찾으시는 예배

예배는 단순히 행위가 아니라, 영적인 상태와 진실된 마음이라는 다층적인 요소를 포함합니다. `stack()`과 `unstack()`은 이처럼 여러 차원의 예배 요소들을 인덱스와 컬럼 간에 전환하여 예배의 본질을 다양한 각도에서 분석하고 재구성하는 데 사용될 수 있습니다.

---

## 🔍 숨겨진 질문 발견

**출애굽기에서 발견할 질문들:**

- 모세의 노래에서 하나님의 '속성'(예: 권능, 구원)과 이스라엘 백성의 '반응'(예: 찬양, 두려움)을 `pivot_table()`로 교차 분석하면, 어떤 속성이 어떤 반응을 이끌어냈는지 알 수 있을까?
- 바다의 노래에 등장하는 다양한 '사건'(예: 홍해 가르심, 애굽 군대 수장)들을 `melt()`로 변환하여, 각 사건이 하나님의 어떤 '속성'을 드러냈는지 추적할 수 있을까?
- 모세와 미리암의 노래를 '주제'(예: 구원, 심판)와 '화자'(모세/미리암)를 기준으로 `stack()`/`unstack()`하면, 각 화자가 어떤 주제를 강조했는지 파악할 수 있을까?

**요한복음에서 발견할 질문들:**

- 예배의 '요소'(예: 신령, 진정)와 '결과'(예: 하나님이 찾으심, 영적 성장)를 `pivot_table()`로 교차 분석하면, 어떤 요소가 더 중요한 결과를 가져왔는지 알 수 있을까?
- 다양한 예배 '형태'(예: 찬양, 기도, 말씀)와 그에 따른 '영적 유익'을 `melt()`로 변환하여, 각 형태가 가져오는 유익을 비교 분석할 수 있을까?
- 예배의 '본질'(신령/진정)과 '행위'(찬양/기도)를 `stack()`/`unstack()`하여, 진정한 예배가 어떤 행위로 나타나는지 다각도로 탐구할 수 있을까?

이런 질문들은 데이터의 '피벗과 형태변환'이라는 관점으로 성경 본문을 더 깊이 이해하는 데 도움을 줄 것이다.

---

## 📊 판다스로 성경 탐구하기

### 탐구 1: 바다의 노래 피벗 및 형태변환 분석 (pivot_table, melt)

```python
import pandas as pd
from .song_of_sea_data import SongOfTheSeaDataGenerator

# 바다의 노래 데이터 생성
data_gen = SongOfTheSeaDataGenerator()
df_song = data_gen.generate_song_of_sea_data()

print("🌊 바다의 노래 데이터 요약:\n", df_song)

# 'attribute_of_God'를 인덱스로, 'israel_response'를 컬럼으로 하는 pivot_table 생성
print("\n--- 하나님의 속성별 이스라엘 반응 Pivot Table (Israel's Response by God's Attribute) ---")
pivoted_song = pd.pivot_table(df_song, values='intensity', index='attribute_of_God', columns='israel_response', aggfunc='sum', fill_value=0)
print(pivoted_song)

# 데이터를 wide 형식에서 long 형식으로 melt
print("\n--- 데이터 Melt (Melting Data from Wide to Long Format) ---")
melted_song = df_song.melt(id_vars=['event_id', 'event_type'], var_name='category', value_name='value')
print(melted_song.head())
```

### 탐구 2: 예배의 본질 스택/언스택 분석 (stack, unstack)

```python
import pandas as pd
from .worship_spirit_truth_data import WorshipSpiritTruthDataGenerator

# 예배 데이터 생성
data_gen = WorshipSpiritTruthDataGenerator()
df_worship = data_gen.generate_worship_data()

print("🙏 예배 데이터 요약:\n", df_worship)

# 'worship_type'과 'outcome'을 멀티인덱스로 설정 후 stack/unstack
print("\n--- 'worship_type'과 'outcome' 멀티인덱스 설정 (Setting MultiIndex) ---")
multi_indexed_worship = df_worship.set_index(['worship_type', 'outcome'])
print(multi_indexed_worship)

# 멀티인덱스를 stack하여 컬럼을 인덱스 레벨로 변환
print("\n--- 데이터 Stack (Stacking Data) ---")
stacked_worship = multi_indexed_worship.stack()
print(stacked_worship.head())

# stack된 데이터를 unstack하여 인덱스 레벨을 컬럼으로 변환
print("\n--- 데이터 Unstack (Unstacking Data) ---")
unstacked_worship = stacked_worship.unstack()
print(unstacked_worship.head())
```

---

## ⭐ 놀라운 발견들

### 발견 1: `pivot_table()`을 통한 구원 역사의 다각적 찬양

모세의 노래 데이터를 `pivot_table()`로 하나님의 속성과 이스라엘의 반응을 교차 분석하면, 하나님의 어떤 속성(예: 권능)이 이스라엘 백성의 어떤 반응(예: 찬양)을 이끌어냈는지 명확하게 볼 수 있습니다. 이는 구원 역사를 다양한 관점에서 재구성하여 하나님의 위대함을 다각도로 찬양하는 바다의 노래와 같습니다.

### 발견 2: `melt()`를 통한 예배 요소의 변화 추적

바다의 노래 데이터를 `melt()`로 변환하면, 각 사건이 하나님의 어떤 속성을 드러냈는지, 또는 각 속성이 어떤 결과를 가져왔는지 긴 형식으로 추적할 수 있습니다. 이는 예배의 다양한 요소(신령, 진정, 행위)가 시간의 흐름에 따라 어떻게 변화하고 상호작용하는지 분석하는 데 유용합니다.

### 발견 3: `stack()`/`unstack()`을 통한 예배 본질의 심층 탐구

예배 데이터를 `stack()`과 `unstack()`을 사용하여 인덱스와 컬럼 간에 전환하면, 예배의 본질(신령/진정)과 행위(찬양/기도)가 어떻게 연결되고 상호작용하는지 다각도로 탐구할 수 있습니다. 이는 진정한 예배가 단순히 외적인 행위가 아니라 내적인 영적 상태와 진실된 마음에서 비롯됨을 데이터적으로 보여줍니다.

---

## 🎨 블렌딩 모드: 출애굽 × 요한복음의 통합 통찰

|출애굽기 진리|요한복음 진리|판다스 도구|영적 발견|
|---|---|---|---|\
|모세와 미리암의 노래 = 구원 역사의 재구성|신령과 진정으로 드리는 예배 = 예배 본질의 재구성|`pivot_table()`|하나님의 위대한 역사를 다양한 관점에서 이해|\
|애굽의 심판과 이스라엘의 구원이라는 사건의 흐름|예배의 다양한 요소와 그 결과의 흐름|`melt()`|시간과 관점에 따른 데이터의 변화 추적|\
|하나님의 속성과 인간의 반응의 교차 분석|예배의 본질과 행위의 상호작용 분석|`stack()`, `unstack()`|다층적인 데이터 구조 속에서 숨겨진 의미 발견|\
|바다의 노래 = 승리의 선포|예수님 = 참된 예배의 대상|데이터 형태변환|하나님을 향한 찬양과 예배의 다양한 표현|\
|구원 역사의 다양한 측면|예배의 다양한 차원|데이터 재구성|하나님의 일하심의 풍성함과 예배의 깊이|\

> **💎 블렌딩 결과**: `pivot_table()`, `melt()`, `stack()`, `unstack()`과 같은 형태변환 기술은 성경 속 구원 역사와 예배의 본질을 다양한 관점에서 재구성하여 숨겨진 패턴과 의미를 발견하는 강력한 도구입니다. 데이터의 형태를 자유자재로 변환함으로써 하나님의 위대함을 다각도로 찬양하고 예배의 깊이를 탐구할 수 있습니다.

---

## 🛠️ 광야 생존 프로젝트: 나의 영적 성장 형태변환 분석

**🎯 미션**: 내 삶의 영적 성장 데이터를 다양한 관점으로 재구성하여 분석하기
**📊 사용 기술**: DataFrame 생성, `pivot_table()`, `melt()`, `stack()`, `unstack()`
**🕊️ 복음 포인트**: "하나님은 영이시니 예배하는 자가 신령과 진정으로 예배할지니라" (요한복음 4:24)

### Step 1: 나의 영적 활동 데이터 피벗 분석

```python
import pandas as pd

my_spiritual_growth = pd.DataFrame({
    '날짜': pd.to_datetime(['2024-01-01', '2024-01-01', '2024-01-02', '2024-01-02']),
    '활동_유형': ['기도', '말씀', '기도', '말씀'],
    '만족도': [4, 5, 3, 4], # 1-5 스케일
    '소요_시간_분': [30, 45, 20, 35]
})

print("🧬 나의 영적 성장 데이터:\n", my_spiritual_growth)

# '날짜'를 인덱스로, '활동_유형'을 컬럼으로 하는 pivot_table 생성
print("\n--- 날짜별 활동 유형별 만족도 Pivot Table (Satisfaction by Activity Type per Date) ---")
pivoted_growth = pd.pivot_table(my_spiritual_growth, values='만족도', index='날짜', columns='활동_유형', aggfunc='mean', fill_value=0)
print(pivoted_growth)

# 데이터를 wide 형식에서 long 형식으로 melt
print("\n--- 데이터 Melt (Melting Data from Wide to Long Format) ---")
melted_growth = my_spiritual_growth.melt(id_vars=['날짜', '활동_유형'], var_name='지표', value_name='값')
print(melted_growth.head())
```

### Step 2: 나의 영적 상태 스택/언스택 분석

```python
my_spiritual_state = pd.DataFrame({
    '주차': [1, 2, 3],
    '평안_지수': [8, 7, 9],
    '감사_지수': [7, 8, 8],
    '근심_지수': [3, 4, 2]
})

print("💡 나의 영적 상태 데이터:\n", my_spiritual_state)

# '주차'를 인덱스로 설정 후 stack
print("\n--- 데이터 Stack (Stacking Data) ---")
stacked_state = my_spiritual_state.set_index('주차').stack()
print(stacked_state.head())

# stack된 데이터를 unstack하여 다시 컬럼으로 변환
print("\n--- 데이터 Unstack (Unstacking Data) ---")
unstacked_state = stacked_state.unstack()
print(unstacked_state.head())
```

---

## 📱 3×10초 광야 루틴

### 🌅 아침 10초: 말씀 묵상

"하나님은 영이시니 예배하는 자가 신령과 진정으로 예배할지니라." (요 4:24)
오늘도 신령과 진정으로 주님을 예배하며 하루를 시작합니다.

### ☀️ 점심 1분: 형태변환 기도

- 오늘 나의 삶에서 다양한 관점으로 재구성해야 할 문제나 상황은 없는지 돌아봅니다.
- 주님, 저의 시야를 넓혀주셔서 `pivot_table()`처럼 다양한 관점에서 상황을 이해하고, `melt()`처럼 본질적인 변화를 추적하게 하소서.

### 🌙 저녁 2분: 데이터 기도일기

**오늘의 영적 데이터:**
- 오늘 나의 영적 활동 데이터를 `pivot_table()`로 분석했을 때, 어떤 활동이 가장 만족스러웠나?
- 나의 영적 상태 데이터를 `stack()`/`unstack()`으로 분석했을 때, 어떤 지표가 가장 두드러졌나?
- 주님, 다양한 관점에서 주님을 예배하고 찬양하게 하시니 감사합니다.

---

## ❓ FAQ & 체크리스트

### 깊이 있는 질문들

**Q1: `pivot_table()`은 어떤 상황에서 유용하게 사용되나요?** A: `pivot_table()`은 데이터를 재구성하여 요약 통계를 계산하는 데 사용됩니다. 하나 이상의 열을 인덱스로, 다른 열을 컬럼으로, 그리고 또 다른 열을 값으로 사용하여 데이터를 교차 분석하고 집계할 때 매우 유용합니다. 예를 들어, 지역별/제품별 매출 합계 등을 분석할 때 사용됩니다.

**Q2: `melt()`는 왜 필요하며, 어떤 형식으로 데이터를 변환하나요?** A: `melt()`는 넓은(wide) 형식의 데이터를 긴(long) 형식으로 변환합니다. 이는 여러 컬럼에 걸쳐 있는 변수들을 하나의 컬럼으로 모으고, 해당 값들을 다른 컬럼에 배치하여 데이터 분석이나 시각화에 더 적합한 형태로 만들 때 유용합니다. 예를 들어, 여러 연도의 매출 데이터가 각각의 컬럼으로 있을 때, 이를 '연도'와 '매출'이라는 두 컬럼으로 변환할 수 있습니다.

**Q3: `stack()`과 `unstack()`은 `MultiIndex`와 어떻게 관련되나요?** A: `stack()`은 DataFrame의 컬럼 레벨을 인덱스 레벨로 변환하여 데이터를 더 긴 형식으로 만듭니다. 반대로 `unstack()`은 인덱스 레벨을 컬럼 레벨로 변환하여 데이터를 더 넓은 형식으로 만듭니다. 이 두 함수는 `MultiIndex`가 설정된 DataFrame에서 데이터의 형태를 자유자재로 변환하는 데 사용됩니다.

**Q4: 바다의 노래에서 `pivot_table()`을 사용하면 어떤 새로운 통찰을 얻을 수 있을까요?** A: 모세의 노래 데이터를 하나님의 속성(예: 권능, 구원)과 이스라엘의 반응(예: 찬양, 두려움)을 기준으로 `pivot_table()`로 교차 분석하면, 어떤 속성이 어떤 반응을 이끌어냈는지, 또는 각 속성이 얼마나 강하게 찬양되었는지 등을 요약하여 볼 수 있습니다. 이는 구원 역사를 다각도로 이해하는 데 도움을 줍니다.

**Q5: 예배의 본질을 `stack()`/`unstack()`으로 분석하는 것이 영적으로 어떤 의미가 있을까요?** A: 예배의 본질(신령/진정)과 외적인 행위(찬양/기도)를 데이터로 구조화한 후 `stack()`/`unstack()`을 사용하면, 진정한 예배가 단순히 외적인 행위가 아니라 내적인 영적 상태와 진실된 마음에서 비롯됨을 다각도로 탐구할 수 있습니다. 이는 예배의 깊이와 진정성을 데이터적으로 묵상하게 합니다.

### ✅ 체크리스트

**성경 이해 체크:**

- [ ] 출애굽기 15장의 모세와 미리암의 노래를 통한 구원 역사의 재구성 이해
- [ ] 요한복음 4장의 신령과 진정으로 드리는 예배의 본질 이해
- [ ] 바다의 노래와 예배 속에서 하나님의 위대함과 예배의 깊이를 이해

**DataFrame 기초 체크:**

- [ ] `pd.pivot_table()` 함수를 사용하여 데이터 재구성 및 요약 성공
- [ ] `df.melt()` 함수를 사용하여 wide 형식 데이터를 long 형식으로 변환 성공
- [ ] `df.stack()` 함수를 사용하여 컬럼 레벨을 인덱스 레벨로 변환 성공
- [ ] `df.unstack()` 함수를 사용하여 인덱스 레벨을 컬럼 레벨로 변환 성공

**영적 적용 체크:**

- [ ] 내 삶의 영적 성장 데이터를 다양한 관점으로 재구성하여 분석 시도 완료
- [ ] 나의 영적 활동과 상태를 `pivot_table()`, `melt()`, `stack()`, `unstack()`으로 분석 시도 완료
- [ ] 데이터 형태변환 원리를 통해 삶의 다양한 측면에서 하나님의 뜻 발견 고민

**발견 기록 체크:**

- [ ] `pivot_table()`을 통한 구원 역사의 다각적 찬양 확인
- [ ] `melt()`를 통한 예배 요소의 변화 추적 통찰
- [ ] `stack()`/`unstack()`을 통한 예배 본질의 심층 탐구 확인

---

## 🧠 미니 퀴즈

**1. `DataFrame`의 데이터를 재구성하여 요약 통계를 계산하는 데 사용되는 함수는?**
a) `df.melt()`
b) `pd.pivot_table()`
c) `df.stack()`

**2. 넓은(wide) 형식의 데이터를 긴(long) 형식으로 변환하는 데 사용되는 함수는?**
a) `df.melt()`
b) `pd.pivot_table()`
c) `df.unstack()`

**3. `MultiIndex`가 설정된 `DataFrame`에서 컬럼 레벨을 인덱스 레벨로 변환하는 함수는?**
a) `df.unstack()`
b) `df.melt()`
c) `df.stack()`

**4. `MultiIndex`가 설정된 `DataFrame`에서 인덱스 레벨을 컬럼 레벨로 변환하는 함수는?**
a) `df.stack()`
b) `df.unstack()`
c) `df.pivot_table()`

**5. 데이터 형태변환의 영적 의미로 가장 적절하지 않은 것은?**
a) 하나님의 위대한 구원 역사를 다양한 관점에서 이해
b) 예배의 본질을 다각도로 탐구
c) 데이터의 원본 형태를 고정하여 분석의 일관성 유지

_(정답: 1-b, 2-a, 3-c, 4-b, 5-c)_

---

## 🎯 깊이 탐구 과제 (선택)

### 초급 과제

1.  **성경 인물 특성 피벗**: 성경 인물 데이터(이름, 성별, 역할, 시대)를 만들고 `성별`을 인덱스로, `역할`을 컬럼으로 하는 `pivot_table()`을 생성하여 각 성별의 주요 역할을 분석해보기
2.  **성경 구절 키워드 Melt**: 성경 구절 데이터(구절 ID, 키워드1, 키워드2, 키워드3)를 만들고 `melt()`를 사용하여 모든 키워드를 하나의 컬럼으로 모아 키워드 빈도 분석해보기

### 중급 과제

1.  **광야 여정 사건 형태변환**: 광야 여정 데이터(날짜, 사건 유형, 이스라엘 반응, 하나님의 개입)를 만들고 `pivot_table()`을 사용하여 날짜별 사건 유형과 이스라엘 반응의 관계를 분석해보기
2.  **예배 요소 스택/언스택**: 예배 활동 데이터(날짜, 찬양 시간, 기도 시간, 말씀 시간)를 만들고 `stack()`/`unstack()`을 사용하여 시간 흐름에 따른 각 예배 요소의 변화를 분석해보기

### 고급 과제

1.  **영적 성장 지표 다차원 분석**: 개인의 영적 활동 데이터(날짜, 활동 유형, 만족도, 영적 성장 기여도)를 만들고 `pivot_table()`과 `melt()`를 조합하여 다양한 관점에서 영적 성장 지표를 분석하고 시각화하는 대시보드 만들기
2.  **교회 공동체 봉사 형태변환 분석**: 가상의 교회 봉사 데이터(봉사자, 봉사 유형, 봉사 시간, 만족도)를 만들고 `pivot_table()`, `stack()`, `unstack()`을 사용하여 봉사자별 봉사 유형, 시간, 만족도 등을 다각도로 분석하여 봉사 배치 효율성 및 만족도 향상 방안 모색해보기

---

## 🌟 다음 여정 예고

**Chapter 16: "만나의 규례 — 윈도우와 롤링"**

이스라엘 백성이 광야에서 매일 만나를 거두었듯이, 데이터 분석에서도 시간의 흐름에 따라 일정 기간 동안의 데이터를 묶어 분석하는 '윈도우(Window)' 함수와 '롤링(Rolling)' 연산은 추세와 변화를 파악하는 데 필수적입니다.

다음 장에서는:

-   **출애굽기 16장**: 만나의 규례 → 매일의 공급과 시간적 제약
-   **요한복음 6:31-35**: 생명의 떡 → 영원한 공급과 지속적인 채움
-   **pandas 기술**: `rolling()`, `expanding()`, 윈도우 함수(mean, sum, std) 등

만나의 규례처럼, 데이터의 윈도우와 롤링 연산을 통해 시간의 흐름 속에서 하나님의 신실한 공급과 영원한 생명의 떡이신 예수님의 은혜를 탐구할 것입니다.

---

## 🙏 한 줄 기도

_"주님, 바다의 노래처럼 주님의 위대한 구원 역사를 다양한 관점에서 찬양합니다.
신령과 진정으로 드리는 예배를 통해 주님을 기쁘시게 하고,
데이터의 형태변환처럼 저의 삶을 주님의 뜻대로 재구성하여 주님께 영광 돌리게 하소서. 예수님의 이름으로 기도합니다. 아멘."_

---

**🎊 열다섯 번째 광야 여정을 완주하신 것을 축하합니다!**

_"여호와는 나의 힘이요 노래시며 나의 구원이시로다 그는 나의 하나님이시니 내가 그를 찬송할 것이요 내 아비의 하나님이시니 내가 그를 높이리로다" (출애굽기 15:2)_

여러분은 이제 데이터 속에서 `pivot_table()`, `melt()`, `stack()`, `unstack()`을 통해 데이터를 다양한 관점으로 재구성하고 숨겨진 패턴과 의미를 발견하는 방법을 알게 되었습니다. 주님께서 주신 지혜로 모든 복잡성 속에서 하나님의 질서를 발견하시길 기도합니다.

**다음 여정에서 만나요! 🌈**
