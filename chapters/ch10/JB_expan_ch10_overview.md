# Chapter 10: 흑암 중의 빛 — 그룹 연산

## 개요 (Overview)
이번 챕터에서는 Pandas의 강력한 `groupby()` 기능을 사용하여 데이터를 그룹별로 나누어 분석하는 방법을 배웁니다. 출애굽기 10장의 메뚜기 재앙과 흑암 재앙, 그리고 요한복음 8장 12절의 "나는 세상의 빛이니"라는 말씀을 통해, 복잡한 데이터 속에서 특정 기준에 따라 질서를 발견하고 의미 있는 통찰을 얻는 과정을 탐구합니다.

This chapter introduces Pandas' powerful `groupby()` functionality to analyze data by dividing it into groups. Through the plagues of locusts and darkness in Exodus 10, and Jesus' declaration "I am the light of the world" in John 8:12, we will explore how to find order and gain meaningful insights from complex data based on specific criteria.

---

## 📜 성경 본문 깊이 묵상

### 출애굽기 10장: 메뚜기 재앙과 흑암 재앙

출애굽기 10장에서는 여덟 번째 재앙인 메뚜기 재앙과 아홉 번째 재앙인 흑암 재앙이 기록되어 있습니다. 이 재앙들은 애굽 땅 전체를 뒤덮었지만, 이스라엘 자손이 거하는 고센 땅에는 명확한 구별이 있었습니다.

- **메뚜기 재앙:** 애굽 땅의 모든 채소와 나무 열매를 먹어 치워 애굽에 남은 것이 없게 함 (출 10:12-15)
- **흑암 재앙:** 삼 일 동안 애굽 온 땅에 흑암이 임하여 서로 볼 수 없었으나, 이스라엘 자손이 거하는 곳에는 광명이 있었음 (출 10:21-23)

이 재앙들은 애굽과 이스라엘이라는 두 '그룹'에 미친 영향이 극명하게 달랐음을 보여줍니다. 데이터 분석에서 `groupby()`는 이처럼 특정 기준(예: 거주 지역)에 따라 데이터를 나누어 각 그룹의 특성을 비교하고 분석하는 데 사용됩니다.

### 요한복음 8:12: "나는 세상의 빛이니"

예수님께서는 "나는 세상의 빛이니 나를 따르는 자는 어두움에 다니지 아니하고 생명의 빛을 얻으리라"고 선언하셨습니다. 이 말씀은 세상의 모든 사람을 '빛을 따르는 자'와 '어둠에 다니는 자'라는 두 그룹으로 나눌 수 있음을 시사합니다. 각 그룹의 삶의 방식, 결과, 그리고 얻게 되는 것이 어떻게 다른지 데이터적으로 탐구할 수 있습니다.

- **빛을 따르는 자:** 어둠에 다니지 않고 생명의 빛을 얻음
- **어둠에 다니는 자:** 빛이 없어 헤매고 생명을 얻지 못함

`groupby()`를 통해 이 두 그룹의 특성을 비교하고, 예수님의 말씀이 가져오는 영적인 구별을 데이터적으로 이해할 수 있습니다.

---

## 🔍 숨겨진 질문 발견

**출애굽기에서 발견할 질문들:**

- 메뚜기 재앙과 흑암 재앙이 애굽과 고센이라는 '그룹'에 미친 평균적인 피해는 어떻게 달랐을까?
- 각 재앙별로 파라오의 반응(마음의 견고함)은 어떻게 '그룹화'하여 분석할 수 있을까?
- 재앙의 종류에 따라 애굽의 경제적/사회적 피해가 어떻게 '그룹별로' 변화했을까?

**요한복음에서 발견할 질문들:**

- '빛을 따르는 그룹'과 '어둠에 다니는 그룹'의 삶의 만족도나 영적 평안은 어떻게 다를까?
- 예수님의 말씀을 들은 사람들의 반응을 '그룹화'하여, 믿음의 정도에 따른 변화를 분석할 수 있을까?
- 성경에서 '빛'과 '어둠'이라는 단어가 사용된 문맥을 '그룹별로' 나누어 그 의미의 차이를 탐구할 수 있을까?

이런 질문들은 데이터의 '그룹 연산'이라는 관점으로 성경 본문을 더 깊이 이해하는 데 도움을 줄 것이다.

---

## 📊 판다스로 성경 탐구하기

### 탐구 1: 재앙의 그룹별 영향 분석 (groupby, agg)

```python
import pandas as pd
from .locusts_darkness_data import LocustsDarknessDataGenerator

# 재앙 데이터 생성
data_gen = LocustsDarknessDataGenerator()
df_plagues = data_gen.generate_plague_impact_data()

print("🔥 재앙 데이터 요약:\n", df_plagues)

# 'target_group'별로 그룹화하여 평균 피해 심각도 계산
print("\n--- 대상 그룹별 평균 피해 심각도 (Average Damage Severity by Target Group) ---")
print(df_plagues.groupby('target_group')['impact_severity'].mean())

# 'plague_name_en'별로 그룹화하여 애굽과 고센의 피해 합계 비교
print("\n--- 재앙별 애굽과 고센의 총 피해 심각도 (Total Damage Severity by Plague Name) ---")
print(df_plagues.groupby('plague_name_en').agg({
    'impact_egypt': 'sum',
    'impact_goshen': 'sum'
}))

# 'pharaoh_response'별로 그룹화하여 재앙의 수 계산
print("\n--- 파라오 반응별 재앙 횟수 (Plague Count by Pharaoh's Response) ---")
print(df_plagues.groupby('pharaoh_response')['plague_name_en'].count())
```

### 탐구 2: 빛과 어둠의 그룹별 특성 분석 (groupby, agg)

```python
import pandas as pd
from .light_of_the_world_data import LightOfTheWorldDataGenerator

# 빛과 어둠 데이터 생성
data_gen = LightOfTheWorldDataGenerator()
df_light_dark = data_gen.generate_light_darkness_data()

print("\n🙏 빛과 어둠 데이터 요약:\n", df_light_dark)

# 'category' (빛/어둠)별로 그룹화하여 평균 영적 평안도 계산
print("\n--- 카테고리별 평균 영적 평안도 (Average Spiritual Peace by Category) ---")
print(df_light_dark.groupby('category')['spiritual_peace'].mean())

# 'category'별로 그룹화하여 '삶의_만족도'와 '영적_성장_지수'의 합계 및 평균 계산
print("\n--- 카테고리별 삶의 만족도 및 영적 성장 지수 (Life Satisfaction & Spiritual Growth by Category) ---")
print(df_light_dark.groupby('category').agg({
    'life_satisfaction': ['mean', 'sum'],
    'spiritual_growth_index': ['mean', 'sum']
}))

# 'concept_type'별로 그룹화하여 각 개념의 출현 횟수 계산
print("\n--- 개념 유형별 출현 횟수 (Concept Count by Type) ---")
print(df_light_dark.groupby('concept_type')['concept_name_en'].count())
```

---

## ⭐ 놀라운 발견들

### 발견 1: 그룹 연산을 통한 하나님의 구별된 보호

`groupby('target_group')`를 통해 애굽과 고센이라는 두 그룹에 대한 재앙의 영향을 명확히 비교할 수 있습니다. 데이터적으로 애굽은 높은 피해 심각도를 보이는 반면, 고센은 현저히 낮은 피해를 보여 하나님의 구별된 보호하심을 통계적으로 확인할 수 있습니다. 이는 `groupby()`가 혼돈 속에서 질서를 발견하는 강력한 도구임을 증명합니다.

### 발견 2: 빛과 어둠 그룹의 극명한 차이

`groupby('category')`를 사용하여 '빛을 따르는 자'와 '어둠에 다니는 자' 그룹의 영적 평안도, 삶의 만족도, 영적 성장 지수를 비교하면 극명한 차이를 발견할 수 있습니다. `agg()`를 통해 각 그룹의 평균과 합계를 계산하면, 예수님을 따르는 삶이 가져오는 풍성한 생명의 빛을 데이터적으로 증명할 수 있습니다.

### 발견 3: `groupby()`는 하나님의 속성을 탐구하는 렌즈

`groupby()`는 단순히 데이터를 묶는 것을 넘어, 하나님의 공의, 사랑, 구별된 보호, 그리고 예수님의 빛 되신 속성을 데이터 속에서 탐구하는 강력한 렌즈가 됩니다. 복잡한 성경 이야기를 그룹별로 나누어 분석함으로써, 하나님의 일하심의 패턴과 그분의 성품을 더 깊이 이해할 수 있습니다.

---

## 🎨 블렌딩 모드: 출애굽 × 요한복음의 통합 통찰

|출애굽기 진리|요한복음 진리|판다스 도구|영적 발견|
|---|---|---|---|
|애굽과 이스라엘의 구별된 재앙|빛과 어둠의 극명한 차이|`groupby()`|하나님의 구별된 사랑과 심판의 기준|
|재앙의 종류별 영향 비교|개념 유형별(빛/어둠) 특성 비교|`agg()`|하나님의 일하심의 다양성과 일관성|
|파라오의 반응에 따른 재앙의 지속|예수님 말씀에 대한 반응과 결과|`groupby().count()`|인간의 자유의지와 하나님의 주권적 역사|
|흑암 속 고센의 광명|어둠 속 생명의 빛|`groupby().filter()`|세상 속에서도 빛을 발하는 성도의 삶|
|메뚜기 재앙의 총체적 피해|빛을 따르는 삶의 총체적 유익|`groupby().sum()`|하나님의 심판과 축복의 규모|

> **💎 블렌딩 결과**: `groupby()`는 복잡한 성경 이야기 속에서 하나님의 구별된 역사와 그분의 성품을 데이터적으로 탐구하는 강력한 도구입니다. 그룹별 분석을 통해 혼돈 속에서 질서를 발견하고, 어둠 속에서 빛을 찾아내는 영적인 통찰을 얻을 수 있습니다.

---

## 🛠️ 광야 생존 프로젝트: 나의 영적 그룹 분석

**🎯 미션**: 내 삶의 영적 상태를 그룹별로 나누어 분석하고 통찰 얻기
**📊 사용 기술**: DataFrame 생성, `groupby()`, `agg()`
**🕊️ 복음 포인트**: "나는 세상의 빛이니 나를 따르는 자는 어두움에 다니지 아니하고 생명의 빛을 얻으리라" (요한복음 8:12)

### Step 1: 나의 영적 활동 데이터 기록

```python
import pandas as pd

my_spiritual_activities = pd.DataFrame({
    '날짜': pd.to_datetime(['2024-01-01', '2024-01-02', '2024-01-03', '2024-01-04', '2024-01-05']),
    '활동_유형': ['기도', '말씀', '봉사', '기도', '말씀'],
    '소요_시간_분': [30, 45, 60, 20, 35],
    '만족도': [4, 5, 5, 3, 4], # 1-5 스케일
    '영적_성장_기여도': [3, 4, 5, 2, 3] # 1-5 스케일
})

print("🧬 나의 영적 활동 데이터:\n", my_spiritual_activities)

# '활동_유형'별로 그룹화하여 평균 소요 시간과 만족도 계산
print("\n--- 활동 유형별 평균 소요 시간 및 만족도 ---")
print(my_spiritual_activities.groupby('활동_유형').agg({
    '소요_시간_분': 'mean',
    '만족도': 'mean',
    '영적_성장_기여도': 'mean'
}))

# '활동_유형'별로 그룹화하여 총 활동 횟수 계산
print("\n--- 활동 유형별 총 횟수 ---")
print(my_spiritual_activities.groupby('활동_유형')['날짜'].count())
```

### Step 2: 나의 영적 상태 그룹 분석

```python
my_spiritual_state = pd.DataFrame({
    '상태_유형': ['감사', '근심', '평안', '불안', '기쁨'],
    '영적_카테고리': ['빛', '어둠', '빛', '어둠', '빛'],
    '강도': [5, 4, 5, 3, 5], # 1-5 스케일
    '빈도_주간': [7, 3, 6, 2, 5]
})

print("\n💡 나의 영적 상태 데이터:\n", my_spiritual_state)

# '영적_카테고리'별로 그룹화하여 강도와 빈도의 평균 계산
print("\n--- 영적 카테고리별 평균 강도 및 빈도 ---")
print(my_spiritual_state.groupby('영적_카테고리').agg({
    '강도': 'mean',
    '빈도_주간': 'mean'
}))

# '영적_카테고리'별로 그룹화하여 가장 강한 상태 유형 찾기
print("\n--- 영적 카테고리별 가장 강한 상태 ---")
print(my_spiritual_state.loc[my_spiritual_state.groupby('영적_카테고리')['강도'].idxmax()])
```

---

## 📱 3×10초 광야 루틴

### 🌅 아침 10초: 말씀 묵상

"나는 세상의 빛이니 나를 따르는 자는 어두움에 다니지 아니하고 생명의 빛을 얻으리라." (요 8:12)
오늘도 빛 되신 주님을 따르며 어둠을 이기겠습니다.

### ☀️ 점심 1분: 그룹 분석 기도

- 오늘 나의 삶에서 '빛의 그룹'에 속한 것(감사, 기쁨, 평안)과 '어둠의 그룹'에 속한 것(근심, 불안)을 그룹별로 나누어 봅니다.
- 각 그룹의 특성을 주님께 아뢰고, 빛의 그룹에 더 집중할 수 있도록 인도해 달라고 기도합니다.

### 🌙 저녁 2분: 데이터 기도일기

**오늘의 영적 데이터:**
- 오늘 나의 영적 활동 중 가장 많은 시간을 할애한 '활동 유형'은?
- 오늘 나의 영적 상태 중 '빛의 카테고리'에 속한 상태들의 평균 강도는?
- 주님, 저를 빛의 자녀로 살게 하소서.

---

## ❓ FAQ & 체크리스트

### 깊이 있는 질문들

**Q1: `groupby()`는 언제 사용해야 하나요?** A: 데이터셋 내에서 특정 기준(하나 이상의 열)에 따라 데이터를 그룹으로 묶어 각 그룹별로 통계(합계, 평균, 개수 등)를 계산하거나, 그룹별로 필터링 또는 변환 작업을 수행하고 싶을 때 사용합니다. 예를 들어, 지역별 매출, 성별 평균 만족도 등을 분석할 때 유용합니다.

**Q2: `agg()` 함수는 `groupby()`와 어떻게 함께 사용되나요?** A: `groupby()`로 데이터를 그룹화한 후, `agg()`를 사용하여 각 그룹에 대해 여러 개의 집계 함수(예: `mean`, `sum`, `count`, `max`, `min`)를 동시에 적용할 수 있습니다. 이는 한 번의 연산으로 다양한 통계량을 얻을 수 있게 해줍니다.

**Q3: 흑암 재앙 속 고센 땅의 광명을 `groupby()`로 어떻게 표현할 수 있을까요?** A: 재앙 데이터에 '지역' 열(애굽, 고센)과 '피해_정도' 열을 추가한 후, `df.groupby('지역')['피해_정도'].mean()`과 같이 그룹별 평균 피해 정도를 계산하여 애굽과 고센의 극명한 차이를 보여줄 수 있습니다. 고센의 피해 정도는 0에 가깝게 나타날 것입니다.

**Q4: 예수님을 따르는 자와 따르지 않는 자의 삶의 차이를 `groupby()`로 어떻게 분석할 수 있을까요?** A: 가상의 데이터에 '따름_여부' 열(True/False)과 '삶의_만족도', '영적_평안' 등의 지표를 포함시킨 후, `df.groupby('따름_여부')['삶의_만족도', '영적_평안'].mean()`과 같이 그룹별 평균을 비교하여 차이를 분석할 수 있습니다.

**Q5: `groupby()`의 결과는 항상 `DataFrame`인가요?** A: `groupby()` 자체는 `DataFrameGroupBy` 객체를 반환합니다. 이 객체에 `sum()`, `mean()`, `agg()` 등의 집계 함수를 적용해야 `Series` 또는 `DataFrame` 형태의 결과가 나옵니다. 어떤 집계 함수를 적용하느냐에 따라 결과의 형태가 달라질 수 있습니다.

### ✅ 체크리스트

**성경 이해 체크:**

- [ ] 출애굽기 10장의 메뚜기/흑암 재앙과 애굽/고센의 구별 이해
- [ ] 요한복음 8:12의 "나는 세상의 빛이니" 말씀의 의미 파악
- [ ] 재앙과 말씀 속에서 하나님의 구별된 역사와 예수님의 속성 이해

**DataFrame 기초 체크:**

- [ ] `groupby()` 함수를 사용하여 데이터 그룹화 성공
- [ ] `agg()` 함수를 사용하여 그룹별 다중 집계 성공
- [ ] 그룹별 평균, 합계, 개수 등 계산 성공
- [ ] 그룹별 필터링 또는 변환 아이디어 구상

**영적 적용 체크:**

- [ ] 내 삶의 영적 활동을 그룹별로 나누어 분석 시도 완료
- [ ] 내 영적 상태를 빛/어둠 카테고리로 그룹 분석 시도 완료
- [ ] `groupby()` 원리를 통해 복잡한 삶 속에서 하나님의 질서 발견 고민

**발견 기록 체크:**

- [ ] 그룹 연산을 통한 하나님의 구별된 보호 확인
- [ ] 빛과 어둠 그룹의 극명한 차이 데이터적으로 확인
- [ ] `groupby()`가 하나님의 속성을 탐구하는 렌즈임을 통찰

---

## 🧠 미니 퀴즈

**1. `DataFrame`에서 특정 열(예: '지역')을 기준으로 데이터를 그룹화하는 함수는?**
a) `filter()`
b) `sort_values()`
c) `groupby()`

**2. `groupby()`로 그룹화된 데이터에 대해 평균과 합계를 동시에 계산하고 싶을 때 사용하는 함수는?**
a) `mean_sum()`
b) `agg()`
c) `apply()`

**3. 출애굽기 10장에서 애굽과 이스라엘(고센)의 재앙 피해를 비교하는 데 가장 적합한 Pandas 기능은?**
a) `df.describe()`
b) `df.groupby('지역')`
c) `df.pivot_table()`

**4. 요한복음 8:12 말씀처럼, '빛을 따르는 자'와 '어둠에 다니는 자' 그룹의 영적 평안도 평균을 비교하는 코드의 핵심은?**
a) `df['영적_평안'].mean()`
b) `df.groupby('따름_여부')['영적_평안'].mean()`
c) `df.filter(items=['영적_평안'])`

**5. `groupby()`의 영적 의미로 가장 적절하지 않은 것은?**
a) 혼돈 속에서 하나님의 질서 발견
b) 세상 속에서 하나님의 구별된 백성 찾기
c) 모든 데이터를 개별적으로 상세히 분석하여 미시적 관점 유지

_(정답: 1-c, 2-b, 3-b, 4-b, 5-c)_

---

## 🎯 깊이 탐구 과제 (선택)

### 초급 과제

1.  **다른 재앙 그룹 분석**: 출애굽기의 다른 재앙들(예: 피 재앙, 개구리 재앙)에 대한 가상의 데이터를 만들고, `groupby()`를 사용하여 애굽과 고센의 피해를 그룹별로 비교해보기
2.  **성경 인물 그룹 분석**: 성경에 나오는 인물들을 '믿음의 영웅', '실패한 인물' 등으로 그룹화하고, 각 그룹의 특징(예: 평균 수명, 주요 사건 수)을 `groupby()`로 분석해보기

### 중급 과제

1.  **파라오의 마음 변화 추적**: 출애굽기 전체에 걸쳐 파라오의 마음 변화를 수치화한 가상의 데이터를 만들고, `groupby()`를 사용하여 재앙 단계별 파라오의 완악함 지수 변화를 분석하고 시각화해보기
2.  **말씀의 영향력 분석**: 특정 성경 구절을 읽은 후의 '영적_평안', '삶의_만족도' 변화를 데이터로 기록하고, `groupby()`를 사용하여 말씀 읽기 전후의 그룹별 변화를 분석해보기

### 고급 과제

1.  **영적 성장 단계별 분석**: 개인의 영적 성장 단계를 정의하고(예: 초신자, 성장기, 성숙기), 각 단계별로 영적 활동(기도, 말씀, 봉사)의 평균 시간, 만족도 등을 `groupby()`와 `agg()`로 상세 분석하여 대시보드 만들기
2.  **교회 공동체 그룹 분석**: 가상의 교회 공동체 데이터를 생성하여, '셀 그룹', '봉사 팀' 등 그룹별로 활동 참여도, 만족도, 영적 성장 지수 등을 `groupby()`로 분석하고, 가장 활발한 그룹의 특징을 찾아내기

---

## 🌟 다음 여정 예고

**Chapter 11: "유월절 — 병합과 연결의 방식"**

유월절은 이스라엘 백성의 구원과 애굽의 심판이라는 두 가지 사건이 하나의 큰 그림 속에서 연결되는 중요한 절기입니다. 데이터 분석에서도 서로 다른 데이터셋을 하나의 의미 있는 정보로 '병합(merge)'하고 '연결(join)'하는 것은 전체적인 그림을 이해하는 데 필수적입니다.

다음 장에서는:

-   **출애굽기 11장**: 열 번째 재앙 예고와 유월절 준비 → 서로 다른 사건의 연결
-   **요한복음 6:4–14**: 오병이어 기적 → 작은 조각들의 병합으로 큰 역사
-   **pandas 기술**: `merge()`, `join()`, `concat()` 등

유월절 어린 양의 피가 구원의 표식이 되었듯이, 데이터 병합과 연결을 통해 흩어진 정보들을 하나로 모아 하나님의 구원 계획을 더 깊이 이해할 것입니다.

---

## 🙏 한 줄 기도

"주님, 흑암 같은 세상 속에서도 빛 되신 주님을 따르며 살게 하소서.
복잡한 데이터 속에서 `groupby()`를 통해 주님의 질서와 구별된 사랑을 발견하게 하시고,
어둠 속에서도 빛을 찾아내는 지혜를 주소서. 예수님의 이름으로 기도합니다. 아멘."

---

**🎊 열 번째 광야 여정을 완주하신 것을 축하합니다!**

"여호와께서 모세에게 이르시되 하늘을 향하여 네 손을 내밀어 애굽 땅 위에 흑암이 있게 하라 곧 더듬을 만한 흑암이니라" (출애굽기 10:21)

여러분은 이제 데이터 속에서 `groupby()`를 통해 혼돈 속에서 질서를 발견하고, 어둠 속에서 빛을 찾아내는 방법을 알게 되었습니다. 주님께서 주신 지혜로 모든 혼돈 속에서 질서를 발견하시길 기도합니다.

**다음 여정에서 만나요! 🌈**
