"""
Chapter 08 í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
ì¬ì•™ ì†ì˜ êµ¬ë¶„ â€” ê³ ì„¼ê³¼ ë§ˆìŠ¤í‚¹

"ì—¬í˜¸ì™€ê»˜ì„œ ë§ì”€í•˜ì‹œê¸°ë¥¼ ë‚´ ë°±ì„±ì„ ë³´ë‚´ë¼ ê·¸ë“¤ì´ ë‚˜ë¥¼ ì„¬ê¸¸ ê²ƒì´ë‹ˆë¼ ë‚´ê°€ ì´ íŒŒë¦¬ë¥¼ ë„ˆì™€ ë„¤ ì‹ í•˜ì™€ ë„¤ ë°±ì„±ê³¼ ë„¤ ì§‘ë“¤ì— ë³´ë‚´ë¦¬ë‹ˆ ì• êµ½ ì‚¬ëŒì˜ ì§‘ì§‘ì— íŒŒë¦¬ê°€ ê°€ë“í•  ê²ƒì´ë©° ê·¸ë“¤ì˜ ê±°í•˜ëŠ” ë•…ì—ë„ ê·¸ëŸ¬í•˜ë¦¬ë¼ ê·¸ëŸ¬ë‚˜ ê·¸ ë‚ ì— ë‚´ê°€ ë‚´ ë°±ì„±ì´ ê±°ì£¼í•˜ëŠ” ê³ ì„¼ ë•…ì„ êµ¬ë³„í•˜ì—¬ íŒŒë¦¬ê°€ ê±°ê¸° ìˆì§€ ëª»í•˜ê²Œ í•˜ë¦¬ë‹ˆ ì´ë¡œ ë§ë¯¸ì•”ì•„ ë„ˆëŠ” ë‚´ê°€ ì„¸ìƒ ì¤‘ì—ì„œ ì—¬í˜¸ì™€ì¸ ì¤„ì„ ì•Œê²Œ ë  ê²ƒì´ë¼ ë‚´ê°€ ë‚´ ë°±ì„±ê³¼ ë„¤ ë°±ì„± ì‚¬ì´ì— êµ¬ë³„ì„ ë‘ë¦¬ë‹ˆ ë‚´ì¼ ì´ í‘œì§•ì´ ìˆìœ¼ë¦¬ë¼ í•˜ì‹œê³ "
"""

import sys
from pathlib import Path

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ì¶”ê°€
PROJECT_ROOT = Path(__file__).parent.parent.parent
sys.path.append(str(PROJECT_ROOT))

# ch08ì˜ ë¶„ì„ ëª¨ë“ˆë“¤ (ì˜ˆìƒ)
from chapters.ch08.second_plague_analysis import analyze_second_plague
from chapters.ch08.second_plague_data import generate_second_plague_data
from chapters.ch08.third_plague_analysis import analyze_third_plague
from chapters.ch08.third_plague_data import generate_third_plague_data

def print_chapter_header():
    """ì±•í„° í—¤ë” ì¶œë ¥"""
    header = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    JesusBornd Pandas Edition                         â•‘
â•‘                                                                      â•‘
â•‘           Chapter 08: ì¬ì•™ ì†ì˜ êµ¬ë¶„ â€” ê³ ì„¼ê³¼ ë§ˆìŠ¤í‚¹                 â•‘
â•‘                                                                      â•‘
â•‘    "ê·¸ëŸ¬ë‚˜ ê·¸ ë‚ ì— ë‚´ê°€ ë‚´ ë°±ì„±ì´ ê±°ì£¼í•˜ëŠ” ê³ ì„¼ ë•…ì„ êµ¬ë³„í•˜ì—¬         â•‘
â•‘     íŒŒë¦¬ê°€ ê±°ê¸° ìˆì§€ ëª»í•˜ê²Œ í•˜ë¦¬ë‹ˆ ì´ë¡œ ë§ë¯¸ì•”ì•„ ë„ˆëŠ” ë‚´ê°€ ì„¸ìƒ       â•‘
â•‘     ì¤‘ì—ì„œ ì—¬í˜¸ì™€ì¸ ì¤„ì„ ì•Œê²Œ ë  ê²ƒì´ë¼ ë‚´ê°€ ë‚´ ë°±ì„±ê³¼ ë„¤ ë°±ì„±       â•‘
â•‘     ì‚¬ì´ì— êµ¬ë³„ì„ ë‘ë¦¬ë‹ˆ ë‚´ì¼ ì´ í‘œì§•ì´ ìˆìœ¼ë¦¬ë¼ í•˜ì‹œê³ " (ì¶œ 8:22-23)   â•‘
â•‘    "ì˜ˆìˆ˜ê»˜ì„œ ë˜ ë§ì”€í•˜ì—¬ ì´ë¥´ì‹œë˜ ë‚˜ëŠ” ì„¸ìƒì˜ ë¹›ì´ë‹ˆ ë‚˜ë¥¼ ë”°ë¥´ëŠ”      â•‘
â•‘     ìëŠ” ì–´ë‘ ì— ë‹¤ë‹ˆì§€ ì•„ë‹ˆí•˜ê³  ìƒëª…ì˜ ë¹›ì„ ì–»ìœ¼ë¦¬ë¼" (ìš” 8:12)         â•‘
â•‘                                                                      â•‘
â•‘    ğŸ—ºï¸  ì¶œì• êµ½ê¸° 8ì¥: ë‘ ë²ˆì§¸(ê°œêµ¬ë¦¬)ì™€ ì„¸ ë²ˆì§¸(ì´) ì¬ì•™ê³¼ ê³ ì„¼ ë•…ì˜ êµ¬ë³„ â•‘
â•‘    ğŸ“Š ìš”í•œë³µìŒ 8:12â€“20: ì„¸ìƒì˜ ë¹›ì´ì‹  ì˜ˆìˆ˜ë‹˜ê³¼ ì˜ì  ë¶„ë³„ë ¥            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """
    print(header)

def run_second_plague_section():
    """ë‘ ë²ˆì§¸ ì¬ì•™ ë¶„ì„ ì„¹ì…˜ ì‹¤í–‰"""
    print("\nğŸ¸ === ì¶œì• êµ½ê¸° ì—¬ì •: ë‘ ë²ˆì§¸ ì¬ì•™, ê°œêµ¬ë¦¬ ì¬ì•™ ===\n")
    print("ê°œêµ¬ë¦¬ ì¬ì•™ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³ , ì¬ì•™ì˜ í™•ì‚°ê³¼ ì˜í–¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.")
    try:
        data = generate_second_plague_data()
        results = analyze_second_plague(data)
        return {"data": data, "analysis_results": results}
    except Exception as e:
        print(f"âŒ ë‘ ë²ˆì§¸ ì¬ì•™ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None

def run_third_plague_section():
    """ì„¸ ë²ˆì§¸ ì¬ì•™ ë¶„ì„ ì„¹ì…˜ ì‹¤í–‰"""
    print("\nğŸ¦Ÿ === ì¶œì• êµ½ê¸° ì—¬ì •: ì„¸ ë²ˆì§¸ ì¬ì•™, ì´ ì¬ì•™ ===\n")
    print("ì´ ì¬ì•™ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³ , ì¬ì•™ì˜ íŠ¹ì„±ê³¼ ê³ ì„¼ ë•…ì˜ êµ¬ë³„ì„ ë¶„ì„í•©ë‹ˆë‹¤.")
    try:
        data = generate_third_plague_data()
        results = analyze_third_plague(data)
        return {"data": data, "analysis_results": results}
    except Exception as e:
        print(f"âŒ ì„¸ ë²ˆì§¸ ì¬ì•™ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None

def show_blending_insights(second_plague_results, third_plague_results):
    """ë¸”ë Œë”© ëª¨ë“œ í†µí•© í†µì°° ì¶œë ¥"""
    print("\nğŸ¨ === ë¸”ë Œë”© ëª¨ë“œ: ì¶œì• êµ½ Ã— ìš”í•œë³µìŒ Ã— ê³ ì„¼ ë•…ì˜ êµ¬ë³„ ===\n")

    blending_insights = [
        "ğŸ¸ ì¬ì•™ì˜ í™•ì‚°ê³¼ í•˜ë‚˜ë‹˜ì˜ ì£¼ê¶Œì ì¸ ê°œì…",
        "ğŸ¦Ÿ ì´ ì¬ì•™: ì• êµ½ì˜ ìˆ ê°ë“¤ë„ í‰ë‚´ ë‚¼ ìˆ˜ ì—†ì—ˆë˜ í•˜ë‚˜ë‹˜ì˜ ëŠ¥ë ¥",
        "ğŸ“ ê³ ì„¼ ë•…ì˜ êµ¬ë³„: í•˜ë‚˜ë‹˜ê»˜ì„œ ë‹¹ì‹ ì˜ ë°±ì„±ì„ ì¬ì•™ ì†ì—ì„œ ë³´í˜¸í•˜ì‹¬",
        "âœ¨ `df.mask()`, `df.where()`: ë°ì´í„°ì—ì„œ í•˜ë‚˜ë‹˜ì˜ êµ¬ë³„ëœ ì€í˜œë¥¼ ì°¾ì•„ë‚´ëŠ” ì§€í˜œ"
    ]

    print("ğŸ’ í•µì‹¬ ë°œê²¬ë“¤:")
    for insight in blending_insights:
        print(f"   {insight}")

def show_next_chapter_preview():
    """ë‹¤ìŒ ì±•í„° ë¯¸ë¦¬ë³´ê¸°"""
    preview = """
ğŸŒŸ === Chapter 09 ë¯¸ë¦¬ë³´ê¸° ===

"ë” í° ì¬ì•™ê³¼ ì¸ë‚´ â€” ë°ì´í„° í†µí•©ê³¼ ë³‘í•©"

ì¶œì• êµ½ê¸° 9ì¥ì—ì„œ ë” í° ì¬ì•™(ì•…ì„± ì¢…ê¸°, ìš°ë°•)ì´ ì„í•˜ê³  íŒŒë¼ì˜¤ì˜ ê°•í…í•¨ì´ ì§€ì†ë˜ë“¯ì´,
ë°ì´í„° ë¶„ì„ì—ì„œë„ ì—¬ëŸ¬ ì¬ì•™ ë°ì´í„°ë¥¼ 'í†µí•©'í•˜ê³  'ë³‘í•©'í•˜ëŠ” ê²ƒì€
ë³µì¡í•œ ìƒí™©ì„ ì¢…í•©ì ìœ¼ë¡œ ì´í•´í•˜ê³ , ìˆ¨ê²¨ì§„ íŒ¨í„´ì„ ë°œê²¬í•˜ëŠ” ë° í•„ìˆ˜ì ì¸ ê¸°ìˆ ì…ë‹ˆë‹¤.

ë‹¤ìŒ ì¥ì—ì„œëŠ”:

-   **ì¶œì• êµ½ê¸° 9ì¥**: ì•…ì„± ì¢…ê¸°, ìš°ë°• ì¬ì•™ â†’ ì—¬ëŸ¬ ë°ì´í„° ì†ŒìŠ¤ì˜ í†µí•©
-   **ìš”í•œë³µìŒ 9:1â€“12**: ë‚  ë•Œë¶€í„° ë§¹ì¸ ëœ ìë¥¼ ê³ ì¹˜ì‹¬ â†’ ì˜ì  í†µì°°ì˜ í†µí•©
-   **pandas ê¸°ìˆ **: `pd.concat()`, `pd.merge()`, `df.join()` ë“±

í•˜ë‚˜ë‹˜ì€ ì¬ì•™ì„ í†µí•´ ë‹¹ì‹ ì˜ ê³„íšì„ ì´ë£¨ì‹œê³ , ì¸ë‚´í•˜ë©° ë‹¹ì‹ ì˜ ë°±ì„±ì„ êµ¬ì›í•˜ì‹­ë‹ˆë‹¤.
ì—¬ëŸ¬ ë°ì´í„°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í†µí•©í•˜ê³  ë³‘í•©í•˜ëŠ” ë²•ì„ ë°°ì›Œ, ë³µì¡í•œ ì„¸ìƒ ì†ì—ì„œ
í•˜ë‚˜ë‹˜ì˜ í° ê·¸ë¦¼ê³¼ ì¸ë‚´ë¥¼ ë°œê²¬í•  ê²ƒì…ë‹ˆë‹¤.
    """
    print(preview)

def run_chapter08(interactive: bool = True):
    """Chapter 08 ì „ì²´ ì‹¤í–‰

    Args:
        interactive: ëŒ€í™”í˜• ëª¨ë“œ ì—¬ë¶€

    Returns:
        dict: ì „ì²´ ë¶„ì„ ê²°ê³¼
    """
    # í—¤ë” ì¶œë ¥
    print_chapter_header()

    if interactive:
        print("ğŸ“– Chapter 08ì„ ì‹œì‘í•©ë‹ˆë‹¤!\n")
        print("ì´ ì±•í„°ì—ì„œëŠ” ì¬ì•™ ì†ì—ì„œ í•˜ë‚˜ë‹˜ì´ ì–´ë–»ê²Œ êµ¬ë³„í•˜ì‹œëŠ”ì§€ë¥¼ ë°ì´í„° ë§ˆìŠ¤í‚¹ì„ í†µí•´ ë‹¤ë£¹ë‹ˆë‹¤.")
        input("\nâ–¶ï¸ ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”...")

    # ê²°ê³¼ ì €ì¥ìš© ë”•ì…”ë„ˆë¦¬
    results = {
        'chapter': '08',
        'title': 'ì¬ì•™ ì†ì˜ êµ¬ë¶„ â€” ê³ ì„¼ê³¼ ë§ˆìŠ¤í‚¹',
        'second_plague_section': None,
        'third_plague_section': None,
    }

    # 1. ë‘ ë²ˆì§¸ ì¬ì•™ ë¶„ì„
    second_plague_results = run_second_plague_section()
    results['second_plague_section'] = second_plague_results

    if interactive:
        input("\nâ–¶ï¸ ì„¸ ë²ˆì§¸ ì¬ì•™ ë¶„ì„ì„ ì‹œì‘í•˜ë ¤ë©´ Enterë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”...")

    # 2. ì„¸ ë²ˆì§¸ ì¬ì•™ ë¶„ì„
    third_plague_results = run_third_plague_section()
    results['third_plague_section'] = third_plague_results

    # 3. ë¸”ë Œë”© í†µì°°
    show_blending_insights(second_plague_results, third_plague_results)

    # 4. ë‹¤ìŒ ì±•í„° ë¯¸ë¦¬ë³´ê¸°
    show_next_chapter_preview()

    # 5. ë§ˆë¬´ë¦¬ ê¸°ë„
    print("\nğŸ™ === ë§ˆë¬´ë¦¬ ê¸°ë„ ===\n")
    prayer = """
ì¬ì•™ ì†ì—ì„œë„ ë‹¹ì‹ ì˜ ë°±ì„±ì„ êµ¬ë³„í•˜ì‹œê³  ë³´í˜¸í•˜ì‹œëŠ” í•˜ë‚˜ë‹˜, ê°ì‚¬í•©ë‹ˆë‹¤.
ì˜¤ëŠ˜ ë°ì´í„°ì˜ êµ¬ë³„ê³¼ ë§ˆìŠ¤í‚¹ì„ ë°°ìš°ë©°, ì„¸ìƒì˜ í˜¼ëˆ ì†ì—ì„œë„
í•˜ë‚˜ë‹˜ì˜ ëª…í™•í•œ ì£¼ê¶Œê³¼ êµ¬ë³„ëœ ì€í˜œë¥¼ ë°œê²¬í•˜ê²Œ í•˜ì‹œë‹ˆ ê°ì‚¬í•©ë‹ˆë‹¤.

ì„¸ìƒì˜ ìœ í˜¹ê³¼ ê³ ë‚œ ì†ì—ì„œë„ ì£¼ë‹˜ì„ ë”°ë¥´ëŠ” ìë“¤ì„ êµ¬ë³„í•˜ì‹œì–´
ìƒëª…ì˜ ë¹› ê°€ìš´ë° ê±°í•˜ê²Œ í•˜ì‹œëŠ” ì£¼ë‹˜ì˜ ì€í˜œë¥¼ ì°¬ì–‘í•©ë‹ˆë‹¤.

ì˜ˆìˆ˜ë‹˜ì˜ ì´ë¦„ìœ¼ë¡œ ê¸°ë„í•©ë‹ˆë‹¤. ì•„ë©˜."
    """
    print(prayer)

    print("\nğŸ‰ Chapter 08 ì™„ë£Œ! ì—¬ëŸ ë²ˆì§¸ ê´‘ì•¼ ì—¬ì •ì„ ë§ˆì¹˜ì…¨ìŠµë‹ˆë‹¤!\n")
    print("ğŸ“Š ì´ì œ ë°ì´í„°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ êµ¬ë³„í•˜ê³  ë§ˆìŠ¤í‚¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!")

    return results

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    try:
        results = run_chapter08(interactive=True)

        # ê²°ê³¼ ì €ì¥ (ì„ íƒì‚¬í•­)
        save_results = input("\nğŸ’¾ ë¶„ì„ ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥í•˜ì‹œê² ì–´ìš”? (y/n, ê¸°ë³¸ê°’ n): ").strip().lower()
        if save_results == 'y':
            import json
            from datetime import datetime

            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"ch08_results_{timestamp}.json"

            summary_results = {
                'chapter': results['chapter'],
                'title': results['title'],
                'completed_at': timestamp,
                'second_plague_section_completed': results['second_plague_section'] is not None,
                'third_plague_section_completed': results['third_plague_section'] is not None,
            }

            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(summary_results, f, ensure_ascii=False, indent=2)

            print(f"âœ… ê²°ê³¼ê°€ {filename}ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")

        return results

    except KeyboardInterrupt:
        print("\n\nâ¸ï¸ ì‚¬ìš©ìê°€ ì¤‘ë‹¨í–ˆìŠµë‹ˆë‹¤.")
        return None
    except Exception as e:
        print(f"\nâŒ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
        print("ğŸ”§ í•„ìš”í•œ ëª¨ë“ˆì´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.")
        return None


if __name__ == "__main__":
    print("ğŸš€ JesusBornd Pandas Chapter 08 ì‹œì‘!\n")
    results = main()
