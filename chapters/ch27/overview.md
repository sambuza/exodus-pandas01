# Chapter 27: 번제단 - 파생변수와 전처리 파이프

## 개요 (Overview)
이번 챕터에서는 Pandas를 사용하여 기존 데이터로부터 새로운 의미 있는 파생변수를 생성하고, 데이터를 분석에 적합한 형태로 전처리하는 다양한 기법을 배웁니다. `assign` 메서드를 활용한 파생변수 생성, `np.where`를 이용한 조건부 로직 적용, 그리고 이러한 전처리 단계를 통합하는 파이프라인 구축을 탐구합니다. 출애굽기 27장의 번제단과 요한복음 3장의 세례 요한의 고백 말씀을 통해, 데이터의 품질을 높이고 분석에 적합한 형태로 만드는 지혜를 데이터적으로 이해하고 묵상합니다.

This chapter introduces various techniques for generating new meaningful derived variables from existing data and preprocessing data into a suitable format for analysis using Pandas. We will explore creating derived variables with the `assign` method, applying conditional logic using `np.where`, and building pipelines to integrate these preprocessing steps. Through the altar of burnt offering in Exodus 27 and John the Baptist's confession in John 3, we will understand and meditate on the wisdom of improving data quality and preparing data for analysis.

---

## 📜 성경 본문 깊이 묵상

### 출애굽기 27장: 번제단

하나님께서는 성막 뜰에 번제단을 만들도록 지시하셨습니다. 번제단은 죄를 속죄하기 위해 짐승을 불태워 드리는 곳으로, 죄를 정결하게 하고 하나님께 나아가는 중요한 통로였습니다. 번제단은 희생과 정결함을 상징하며, 죄를 처리하고 하나님과의 관계를 회복하는 데 필수적인 역할을 했습니다. 이는 데이터의 불순물을 제거하고 정결하게 하는 전처리 과정과 유사합니다.

- **재료와 치수:** 조각목으로 만들고 놋으로 싸며, 길이와 너비가 각각 5규빗 (출 27:1-2)
- **속죄의 장소:** 죄를 정결하게 하는 희생 제사 (레 1:1-17)
- **정결함:** 하나님께 나아가기 위한 필수적인 과정

이 본문은 데이터 전처리 과정에 영감을 줍니다. 데이터의 불순물(오류, 노이즈)을 제거하고, 분석에 적합한 형태로 만드는 것은 번제단이 죄를 정결하게 하는 것과 같습니다. 파생변수를 생성하는 것은 기존 데이터에 새로운 의미를 부여하여 분석의 깊이를 더하는 것이며, 조건부 로직을 적용하는 것은 데이터의 특정 상황에 따라 적절한 처리를 하는 것입니다. 이러한 전처리 과정은 데이터의 품질을 높이고, 분석 결과의 신뢰성을 확보하는 데 필수적입니다.

### 요한복음 3:30: 그가 흥하여야 하겠고 나는 쇠하여야 하리라

세례 요한은 예수님에 대해 "그는 흥하여야 하겠고 나는 쇠하여야 하리라"고 고백했습니다. 이는 자신을 낮추고 예수님을 높이는 겸손한 태도를 보여줍니다. 세례 요한의 사명은 예수님의 길을 예비하는 것이었으며, 자신은 예수님께 집중하기 위해 뒤로 물러나는 것이 마땅하다고 여겼습니다. 이는 데이터 분석에서 원본 데이터의 가치를 극대화하기 위한 전처리 과정과 유사합니다.

- **겸손한 고백:** 자신을 낮추고 예수님을 높임
- **사명의 완성:** 예수님의 길을 예비함
- **본질에 집중:** 불필요한 것을 덜어내고 핵심에 집중

이 말씀은 파생변수 생성과 전처리 파이프라인 구축에 영감을 줍니다. 원본 데이터(나)를 그대로 두기보다, 새로운 파생변수(예수님)를 생성하여 데이터의 가치를 극대화하고, 불필요한 요소(나)를 덜어내는 전처리 과정은 세례 요한의 겸손한 고백과 같습니다. `assign`과 `np.where`는 이러한 데이터 변환을 통해 분석의 본질에 집중하고, 데이터의 숨겨진 의미를 드러내는 데 도움을 줍니다.

---

## 🔍 숨겨진 질문 발견

**출애굽기에서 발견할 질문들:**

- 번제단 관련 데이터를 만들고 `assign`을 사용하여 '희생 지수'나 '정결 지수'와 같은 파생변수를 생성하면, 어떤 제사가 가장 높은 정결함을 가져왔을까?
- `np.where`를 사용하여 제사 유형에 따라 다른 처리(예: 번제, 화목제)를 적용하면, 각 제사의 목적과 결과는 어떻게 달라질까?
- 전처리 파이프라인을 구축하여 번제단 관련 데이터를 정제하면, 제사 과정의 효율성과 정확성은 어떻게 향상될까?

**요한복음에서 발견할 질문들:**

- 세례 요한의 사역 데이터를 만들고 `assign`을 사용하여 '예수님 증거 지수'나 '겸손 지수'와 같은 파생변수를 생성하면, 세례 요한의 사역이 예수님께 얼마나 집중되었을까?
- `np.where`를 사용하여 사람들의 반응(예: 믿음, 불신)에 따라 다른 영적 상태를 분류하면, 예수님의 말씀이 어떤 영향을 미쳤을까?
- 전처리 파이프라인을 구축하여 세례 요한과 예수님의 사역 데이터를 통합 분석하면, 두 사역의 연관성과 시너지를 어떻게 이해할 수 있을까?

이런 질문들은 데이터의 '파생변수와 전처리 파이프'라는 관점으로 성경 본문을 더 깊이 이해하는 데 도움을 줄 것이다.

---

## 📊 판다스로 성경 탐구하기

### 탐구 1: 번제단 데이터 파생변수 생성 (assign, np.where)

```python
import pandas as pd
import numpy as np
from chapters.ch27.altar_data import AltarDataGenerator

# 번제단 데이터 생성
data_gen = AltarDataGenerator()
df_altar = data_gen.generate_altar_data()

print("🔥 번제단 데이터 요약:\n", df_altar.head())

# 'value1'과 'value2'를 이용한 파생변수 'sum_values' 생성
df_altar_derived = df_altar.assign(sum_values=df_altar['value1'] + df_altar['value2'])
print("\n--- 'sum_values' 파생변수 추가 후 ---")
print(df_altar_derived.head())

# `np.where`를 사용하여 'value1_level' 파생변수 생성
df_altar_derived['value1_level'] = np.where(df_altar_derived['value1'] > 50, 'High', 'Low')
print("\n--- 'value1_level' 파생변수 추가 후 ---")
print(df_altar_derived.head())
```

### 탐구 2: 세례 요한의 고백 데이터 전처리 파이프라인 (assign, np.where)

```python
import pandas as pd
import numpy as np
from chapters.ch27.altar_data import AltarDataGenerator # 동일 데이터 생성기 사용
from chapters.ch27.derived_variables import DerivedVariableCreator
from chapters.ch27.conditional_processing import ConditionalProcessor
from chapters.ch27.preprocessing_pipeline import PreprocessingPipeline

# 세례 요한의 고백 데이터 생성 (가정)
data_gen = AltarDataGenerator()
df_john = data_gen.generate_altar_data()

print("💧 세례 요한의 고백 데이터 요약:\n", df_john.head())

# 전처리 파이프라인 실행
pipeline = PreprocessingPipeline(df_john)
processed_df_john = pipeline.run_pipeline()

print("\n--- 전처리 파이프라인 실행 후 (세례 요한의 고백 데이터) ---")
print(processed_df_john.head())
```

---

## ⭐ 놀라운 발견들

### 발견 1: `assign`을 통한 데이터의 풍성함과 분석의 깊이

`assign` 메서드를 사용하여 기존 컬럼을 기반으로 새로운 파생변수를 생성하는 것은 번제단이 죄를 정결하게 하는 것과 같이 데이터에 새로운 의미를 부여하고 분석의 깊이를 더하는 것과 같습니다. 이는 데이터의 숨겨진 패턴을 발견하고, 더 풍성한 통찰을 얻는 데 필수적입니다.

### 발견 2: `np.where`를 통한 조건부 로직과 공의로운 처리

`np.where`를 사용하여 특정 조건에 따라 데이터를 분류하거나 변환하는 것은 번제단이 죄의 종류에 따라 다른 제사를 드리는 것과 같이 데이터에 공의로운 처리를 적용하는 것과 같습니다. 이는 데이터의 특정 상황에 따라 적절한 분석을 수행하고, 편향되지 않은 결과를 얻는 데 도움을 줍니다.

### 발견 3: 전처리 파이프라인은 겸손한 준비와 본질에 집중

데이터 전처리 파이프라인을 구축하여 여러 단계를 통합하는 것은 세례 요한이 자신을 낮추고 예수님의 길을 예비한 것처럼, 데이터 분석의 본질(예수님)에 집중하기 위한 겸손한 준비 과정과 같습니다. 이는 데이터의 품질을 높이고 분석에 적합한 형태로 만들어, 데이터가 가진 진정한 가치를 극대화하는 데 기여합니다.

---

## 🎨 블렌딩 모드: 출애굽 × 요한복음의 통합 통찰

|출애굽기 진리|요한복음 진리|판다스 도구|영적 발견|
|---|---|---|---|
|번제단 = 죄를 정결케 하는 희생|세례 요한의 고백 = 자신을 낮추고 예수님을 높임|`assign`|데이터의 가치 극대화와 겸손한 준비|
|데이터의 불순물 제거|불필요한 것을 덜어내고 본질에 집중|`np.where`|데이터에 공의로운 처리와 영적 분별력|
|정결함과 분석 적합성|예수님의 길을 예비하는 사명|전처리 파이프라인|데이터 품질 향상과 분석의 신뢰성|
|데이터의 새로운 의미 부여|영적 성장의 깊이|파생변수 생성|데이터 속 숨겨진 패턴과 하나님의 지혜|
|데이터의 품질 향상|분석 결과의 신뢰성 확보|전처리 과정|영적 정화와 성숙을 위한 노력|

> **💎 블렌딩 결과**: `assign`, `np.where`, 전처리 파이프라인과 같은 파생변수 및 전처리 기술은 성경 속 번제단과 세례 요한의 고백 말씀을 데이터적으로 분석하는 강력한 도구입니다. 데이터의 품질을 높이고 분석에 적합한 형태로 만드는 과정을 통해, 영적 정화와 겸손의 중요성을 깨닫고 하나님의 지혜로운 데이터 관리 원리를 이해할 수 있습니다.

---

## 🛠️ 광야 생존 프로젝트: 나의 영적 성장 파생변수 분석

**🎯 미션**: 내 삶의 영적 성장 데이터를 파생변수로 분석하고 전처리 파이프라인 구축하기
**📊 사용 기술**: DataFrame 생성, `assign`, `np.where`, 전처리 파이프라인
**🕊️ 복음 포인트**: "그가 흥하여야 하겠고 나는 쇠하여야 하리라" (요한복음 3:30)

### Step 1: 나의 영적 활동 데이터 기록 및 파생변수 생성

```python
import pandas as pd
import numpy as np

my_spiritual_growth = pd.DataFrame({
    '날짜': pd.to_datetime(pd.date_range(start='2024-01-01', periods=10, freq='D')),
    '기도_시간_분': [30, 45, 20, 35, 50, 25, 40, 60, 20, 55],
    '말씀_묵상_시간_분': [20, 30, 15, 25, 40, 10, 30, 45, 10, 35],
    '감사_지수': [7, 8, 6, 7, 9, 5, 8, 10, 6, 9]
})

print("🧬 나의 영적 성장 로그:\n", my_spiritual_growth.head())

# 총 영적 활동 시간 파생변수 생성
my_spiritual_growth_derived = my_spiritual_growth.assign(
    총_영적_활동_시간_분=lambda x: x['기도_시간_분'] + x['말씀_묵상_시간_분']
)
print("\n--- 총 영적 활동 시간 파생변수 추가 후 ---")
print(my_spiritual_growth_derived.head())

# `np.where`를 사용하여 '영적_상태_레벨' 파생변수 생성
my_spiritual_growth_derived['영적_상태_레벨'] = np.where(
    my_spiritual_growth_derived['감사_지수'] > 7,
    'High',
    np.where(my_spiritual_growth_derived['감사_지수'] > 4, 'Medium', 'Low')
)
print("\n--- '영적_상태_레벨' 파생변수 추가 후 ---")
print(my_spiritual_growth_derived.head())
```

### Step 2: 나의 영적 성장 전처리 파이프라인 구축

```python
# 전처리 파이프라인 함수 정의 (예시)
def my_preprocessing_pipeline(df: pd.DataFrame) -> pd.DataFrame:
    df_processed = df.copy()
    # 1. 파생변수 생성
    df_processed = df_processed.assign(
        총_영적_활동_시간_분=lambda x: x['기도_시간_분'] + x['말씀_묵상_시간_분']
    )
    # 2. 조건부 로직 적용
    df_processed['영적_상태_레벨'] = np.where(
        df_processed['감사_지수'] > 7,
        'High',
        np.where(df_processed['감사_지수'] > 4, 'Medium', 'Low')
    )
    # 3. 불필요한 컬럼 제거 (예시)
    df_processed = df_processed.drop(columns=['기도_시간_분', '말씀_묵상_시간_분'])
    return df_processed

# 파이프라인 실행
final_processed_growth = my_preprocessing_pipeline(my_spiritual_growth)
print("\n--- 나의 영적 성장 전처리 파이프라인 실행 후 ---")
print(final_processed_growth.head())
```

---

## 📱 3×10초 광야 루틴

### 🌅 아침 10초: 말씀 묵상

"그가 흥하여야 하겠고 나는 쇠하여야 하리라." (요 3:30)
오늘도 자신을 낮추고 주님을 높이는 하루를 시작합니다.

### ☀️ 점심 1분: 파생변수 기도

- 나의 삶에서 `assign`처럼 새로운 의미를 부여해야 할 영역은 없는지 돌아봅니다.
- `np.where`처럼 특정 조건에 따라 나의 태도나 행동을 변화시켜야 할 부분은 없는지 점검합니다.
- 주님, 저의 삶이 주님께 집중하는 파생변수가 되게 하소서.

### 🌙 저녁 2분: 데이터 기도일기

**오늘의 영적 데이터:**
- 오늘 `assign`으로 생성해 본 나의 영적 파생변수는?
- `np.where`로 적용해 본 나의 영적 조건부 로직은?
- `전처리 파이프라인`처럼 나의 삶을 정결하게 하고 주님께 집중하게 한 과정은?
- 주님, 번제단처럼 정결한 마음으로, 세례 요한처럼 겸손한 자세로 주님을 섬기게 하소서.

---

## ❓ FAQ & 체크리스트

### 깊이 있는 질문들

**Q1: 파생변수(Derived Variables)는 왜 중요하며, `assign` 메서드는 어떻게 활용되나요?** A: 파생변수는 기존 컬럼들을 조합하거나 변형하여 새로운 의미를 가지는 컬럼을 생성하는 것입니다. 이는 데이터의 풍부함을 더하고, 분석의 깊이를 높이며, 모델의 성능을 향상시키는 데 중요합니다. Pandas의 `assign` 메서드는 기존 DataFrame을 변경하지 않고 새로운 컬럼을 추가한 DataFrame을 반환하여 코드의 가독성과 유지보수성을 높입니다.

**Q2: `np.where`는 어떤 상황에서 유용하게 사용되나요?** A: `np.where`는 특정 조건에 따라 값을 선택적으로 변경하거나 새로운 컬럼을 생성할 때 매우 유용합니다. 예를 들어, 특정 점수 이상이면 '합격', 아니면 '불합격'으로 분류하거나, 특정 카테고리에 따라 다른 계산을 적용할 때 사용됩니다. 이는 데이터에 조건부 로직을 효율적으로 적용하는 데 필수적입니다.

**Q3: 전처리 파이프라인(Preprocessing Pipeline)을 구축하는 주된 이유는 무엇인가요?** A: 전처리 파이프라인은 여러 데이터 전처리 단계를 하나의 연속적인 흐름으로 묶는 것입니다. 이는 코드의 재사용성을 높이고, 데이터 처리 과정을 자동화하며, 분석의 일관성과 재현성을 확보하는 데 중요합니다. 또한, 복잡한 전처리 과정을 체계적으로 관리하여 오류 발생 가능성을 줄입니다.

**Q4: 번제단이 파생변수와 전처리 파이프와 어떤 영적 의미로 연결될 수 있을까요?** A: 번제단은 죄를 정결하게 하고 하나님께 나아가는 통로였습니다. 데이터 전처리 과정은 데이터의 불순물을 제거하고 분석에 적합한 형태로 만드는 것과 같습니다. 파생변수 생성은 데이터에 새로운 의미를 부여하여 분석의 깊이를 더하는 것이며, 이는 하나님과의 관계를 회복하고 더 깊이 나아가는 영적 과정과 연결됩니다.

**Q5: 세례 요한의 고백이 전처리 파이프라인과 어떤 영적 의미로 연결될 수 있을까요?** A: 세례 요한은 자신을 낮추고 예수님을 높이는 겸손한 태도를 보였습니다. 데이터 전처리 파이프라인은 원본 데이터의 가치를 극대화하기 위해 불필요한 요소를 덜어내고, 분석의 본질에 집중하는 과정입니다. 이는 영적으로 자신을 쇠하게 하고 예수님을 흥하게 하는 겸손한 준비와 본질에 집중하는 태도와 같습니다.

### ✅ 체크리스트

**성경 이해 체크:**

- [ ] 출애굽기 27장의 번제단과 정결함의 의미 이해
- [ ] 요한복음 3장의 세례 요한의 고백과 겸손의 중요성 이해
- [ ] 데이터 전처리 과정을 통해 영적 정화와 겸손의 원리를 이해

**DataFrame 기초 체크:**

- [ ] `df.assign()` 함수를 사용하여 파생변수 생성 성공
- [ ] `np.where()` 함수를 사용하여 조건부 로직 적용 성공
- [ ] 여러 전처리 단계를 포함하는 파이프라인 구축 개념 이해
- [ ] 파이프라인을 통해 데이터 처리의 효율성과 일관성 확보

**영적 적용 체크:**

- [ ] 내 삶의 영적 성장 데이터를 파생변수로 분석 시도 완료
- [ ] 나의 영적 상태에 `assign`과 `np.where` 원리를 적용하여 변화를 추적 시도 완료
- [ ] 전처리 파이프라인 원리를 통해 영적 정화와 겸손한 준비 노력

**발견 기록 체크:**

- [ ] `assign`을 통한 데이터의 풍성함과 분석의 깊이 확인
- [ ] `np.where`를 통한 조건부 로직과 공의로운 처리 통찰
- [ ] 전처리 파이프라인이 겸손한 준비와 본질에 집중함을 확인

---

## 🧠 미니 퀴즈

**1. 기존 컬럼을 기반으로 새로운 컬럼을 생성하여 DataFrame에 추가하는 Pandas 메서드는?**
 a) `df.add_column()`
 b) `df.create_column()`
 c) `df.assign()`

**2. 특정 조건에 따라 값을 선택적으로 변경하거나 새로운 컬럼을 생성할 때 유용한 NumPy 함수는?**
 a) `np.select()`
 b) `np.choose()`
 c) `np.where()`

**3. 여러 데이터 전처리 단계를 하나의 연속적인 흐름으로 묶는 것을 무엇이라고 하는가?**
 a) 데이터 클렌징
 b) 데이터 파이프라인
 c) 데이터 모델링

**4. 번제단이 파생변수와 전처리 파이프와 연결되는 영적 의미로 가장 적절한 것은?**
 a) 데이터의 불순물을 제거하고 분석에 적합한 형태로 만듦
 b) 데이터의 양을 늘려 하나님의 풍성함을 표현
 c) 데이터의 시각적 아름다움을 강조하여 사람들의 관심을 유도

**5. 세례 요한의 고백이 전처리 파이프라인과 연결되는 영적 의미로 가장 적절하지 않은 것은?**
 a) 자신을 낮추고 예수님을 높이는 겸손한 준비 과정
 b) 데이터 분석의 본질에 집중하기 위한 노력
 c) 데이터의 외형적인 모습만을 중요시하여 본질을 간과함

_(정답: 1-c, 2-c, 3-b, 4-a, 5-c)_

---

## 🎯 깊이 탐구 과제 (선택)

### 초급 과제

1.  **성경 인물 특성 파생변수**: 성경 인물 데이터(이름, 출생 연도, 사망 연도)를 만들고, `생존 기간`이라는 파생변수를 `assign`으로 생성해보기
2.  **성경 사건 조건부 분류**: 성경 사건 데이터(사건 유형, 중요도 점수)를 만들고, `np.where`를 사용하여 `중요도 점수`가 특정 값 이상이면 '핵심 사건', 아니면 '일반 사건'으로 분류하는 파생변수 생성해보기

### 중급 과제

1.  **교회 봉사 활동 전처리 파이프라인**: 가상의 교회 봉사 데이터(봉사자 ID, 봉사 시간, 만족도, 참여 횟수)를 만들고, `assign`으로 `시간당 만족도` 파생변수를 생성하고, `np.where`로 `우수 봉사자`를 분류하는 전처리 파이프라인을 함수로 구현해보기
2.  **영적 성장 지표 조건부 분석**: 개인의 영적 성장 지표(예: 기도 시간, 말씀 묵상 시간, 감사 지수) 데이터를 만들고, `np.where`를 사용하여 `기도 시간`이 특정 시간 이상이고 `말씀 묵상 시간`이 특정 시간 이상이면 '영적 성장', 아니면 '정체'로 분류하는 파생변수 생성해보기

### 고급 과제

1.  **데이터 품질 향상 파이프라인 설계**: 복잡한 가상의 데이터셋(결측치, 이상치, 잘못된 형식 등 포함)을 만들고, `fillna()`, `dropna()`, `assign`, `np.where` 등을 포함하는 데이터 품질 향상 전처리 파이프라인을 구축하여 데이터의 무결성과 분석 적합성을 극대화하는 시스템(개념) 설계해보기
2.  **영적 리더십 평가 파이프라인**: 성경 인물 데이터(이름, 리더십 스타일, 영향력 점수, 섬김 점수)를 만들고, `assign`으로 `리더십 효율성` 파생변수를 생성하고, `np.where`로 `모범 리더`를 분류하는 전처리 파이프라인을 구축하여 영적 리더십을 평가하고 분석하는 보고서 작성해보기

---

## 🌟 다음 여정 예고

**Chapter 28: "제사장 옷 - 라벨링과 스타일링 (Priestly Garments - Labeling and Styling)"**

제사장 옷이 하나님의 영광과 거룩함을 드러내듯, 데이터 분석에서도 라벨링과 스타일링은 데이터의 의미를 명확히 하고 시각적 효과를 높여 통찰을 더욱 풍성하게 합니다.

Just as the priestly garments reveal God's glory and holiness, in data analysis, labeling and styling clarify data meaning and enhance visual impact, enriching insights.

다음 장에서 배울 내용 (What you'll learn in the next chapter):
📁 범주형 데이터의 효과적인 관리
🔍 데이터프레임 스타일링을 통한 시각화 강화
🎯 데이터의 의미를 명확히 하는 라벨링 기법
📊 제사장 옷처럼 아름답고 의미 있는 데이터 표현

"모세가 그 장인의 말을 듣고 그 말대로 하여" (출애굽기 28:1-5)
"나는 선한 목자라 나는 내 양을 알고 양도 나를 아는 것이" (요한복음 10:14)

---

## 🙏 한 줄 기도

_"주님, 번제단처럼 정결한 마음으로 데이터 분석에 임하게 하시고, 세례 요한처럼 자신을 낮춰 주님의 영광을 드러내는 파생변수와 전처리 과정을 통해 데이터의 가치를 극대화하게 하소서.
예수님의 이름으로 기도합니다. 아멘."_

---

**🎊 스물일곱 번째 광야 여정을 완주하신 것을 축하합니다!**

"그가 흥하여야 하겠고 나는 쇠하여야 하리라" (요한복음 3:30)

여러분은 이제 데이터 속에서 `assign`, `np.where`, 전처리 파이프라인을 통해 파생변수를 생성하고 데이터를 전처리하는 방법을 알게 되었습니다. 주님께서 주신 지혜로 모든 데이터 속에서 하나님의 지혜로운 데이터 관리 원리를 발견하시길 기도합니다.

**다음 여정에서 만나요! 🌈**
